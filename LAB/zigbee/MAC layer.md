

# MAC Layer

  MAC는 물리 계층과 MAC 위의 상위 계층 사이에서 인터페이스를 제공합니다.
  지그비 네트워크에서 이 다음 상위 계층은 NWK 층입니다.
  IEEE 802.15.4는 특별히 ZigBee 애플리케이션을 위해 개발되지 않았으며, 다음 상위 계층은 모든 네트워킹 프로토콜 계층이 될 수 있다.
  이 글에서 MAC 서비스는 직비 NWK층의 인터페이싱을 위해 논의 될 것이다.
  
![image](https://user-images.githubusercontent.com/43804441/52327615-11fb7600-2a30-11e9-8322-3d89d99fe7fc.png)
  
   위 그림 3.6은 맥 부계층 모델을 보여준다. 
   물리 계층과 비슷하게 맥 계층은 MAC Layer Management Entity (MLME) 라고 불리며 MAC 관리 서비스를 위한 관리체를 포함합니다.
   MLME는 NWK층의 NLME와 상호작용합니다.
    
   또한 MAC는 MAC-PIB라 불리는 자신만의 데이터베이스를 같는다.
   모든 MAC 변수들은 a라는 일반적인 접두사를 가진다. MAC 속성은 일반적으로 mac접두사를 가진다.
   MAC-PIB의 크기는 PHY-PIB보다 크다.  MAC 변수와 속성의 표는 802.15.4 표준 문서에 포함된다.
    
 
## Beacon-Enabled Operation and Superframe Structure ( Beacon-Enabled 작동 및 슈퍼프레임 구조 )

   beacon-enabled 네트워크의 이점 중 한가지는 보장된 시간 간격(GTSs)의 가용성이다.
   비콘 프레임들은 비콘들과 GTSs의 수 사이의 시간 간격과 같은 비콘정보를 포함하는 MAC 프레임들이다.
   비콘 포맷은 밑에서 설명할 것이다.


![image](https://user-images.githubusercontent.com/43804441/52329560-76b9cf00-2a36-11e9-9492-bdc615c74f96.png)


   beacon-enabled 수행에서 슈퍼프레임 구조를 사용하는 것이 가능하다.
   슈퍼프레임은 위 그림과 같은데, 두개의 비콘 프엠으로 둘러 싸여 있다.    
   슈퍼프레임 구조의 사용은 802.15.4표준에서 선택적이다. 
   슈퍼 프레임에는 경합 엑세스 주기 CAP, 경합 없는 주기 CFP, 비활동기간의 3가지 타입의 기간이 있다.
    
   CAP 동안 송신하고자 하는 모든 장치는 주파수 채널에 접근하기 위해 CSMA-CA 메커니즘을 사용해야 한다
   주파수 채널은 같은 네트워크 상의 모든 장비를 동일하게 사용가능합니다.
   사용 가능한 채널을 사용하여 시작하는 첫 번째 장치는 현재 전송이 완료될 때까지 자체적으로 유지합니다.
   장치가 사용 중인 채널을 발견하면 임의의 시간 동안 꺼지고 다시 시도한다.
   이것은 대규모 네트워크에서 대부분의 장치에 대한 채널 액세스 메커니즘일 가능성이 가장 높다.
   MAC 제어 프레임은 CAP 동안 전송된다.
    
   CAP 중에는 장치가 필요할 때 주파수 채널을 사용할 수 있다는 보장이 없다.
   대조적으로 CFP는 특별한 장비를 위한 타음 슬롯을 보장하고 그래서 장비는 채널 접속을 위한 CSMA-CA를 사용할 필요가 없다.
   이는 기기가 채널을 사용할 수 있을때까지 무작위적이거나 잠재적인 긴 시간 주기를 기다릴 필요가 없는 짧은 지연 어플리케이션에 좋은 선택이다.
   CSMA-CA는 CFP와 함께 사용할 수 없다.
    
   CAP와 CFP의 결합은 활동 주기로 알려졌다. 
   활동 주기는 16개의 동일한 타음슬롯으로 나누어져 있다. 비콘 프레임은 항상 첫번째 타음 슬롯의 시작 부분에서 시작한다.
   CFP에서 7개의 GTSs가 있을 수 있다. 각 GTS는 하나 또는 더 많은 타임슬롯을 차지한다.
   
   슈퍼프레임은 선택적으로 비활동 주기를 가질수 있다. 비활동 주기에 장비는 전력 절약 모드가 될 수 있다.
   전력 절약 모드에서 코디네티어는 배터리 에너지 절약을 위해 송수신 회로를 끌 수 있다.
   
   슈퍼 프레임의 구조는 코디네이터에 의해 정의되고 MLME-START.request primitive 를 사용하여 NWK 층에 의해 구성된다.
   두 개의 연속적인 비콘 사이의 지속시간인 비콘 간격 (BI)은 다음 공식을 사용한 macBeaconOrder(BO) 속성과 aBaseSuperframeDuration 변수
   에 의해 결정된다.
    

![image](https://user-images.githubusercontent.com/43804441/52334805-fac68380-2a43-11e9-867a-651f066755ea.png)

   예를 들어 960의 Base Superframe 기호 구성 및 2의 macBeaconOrder를 지정하면 신호 간격이 3840 기호로 지정됨
   macBeaconOrder는 신호 사용 네트워크에서 0부터 14까지의 값을 가질 수 있다. 
   macBeaconOrder의 값이 15로 설정된 경우, 네트워크는 nonbeacon-enable인 것으로 간주되며, 어떤 수퍼프레임 논의도 적용되지 않는다
   
   비슷하게, 슈퍼프레임의 활동주기의 길이인 슈퍼프레임 기간 (SD)는 다음 공식으로 계산된다. 

![image](https://user-images.githubusercontent.com/43804441/52334985-935d0380-2a44-11e9-8669-84918cee2285.png)

   여기서 SO는 macSuperframeOrder 특성의 값이다. 슈퍼프레임 기간은 비콘 기간을 초과할 수 없다. 그래서 SO의 값은 항상 BO보다 같거나 작다.
   
   nonbeacon-enable 네트워크에서 ( BO가 15일 때) 코디네이터는 네트워크의 장치에서 비콘 요청 명령을 수신하지 않는 한 비콘을 전송하지 않는다.
   비콘 요청 명령은 코디네이터를 찾기 위해 장치에 의해 사용된다. 비콘 요청 명령의 포맷은 밑에서 보여질 것이다.
   nonbeacon-enabled 네트워크에서 PAN 코디네이터는 macSuperframeOrder의 값을 15로 설정한다.
   
  
   beacon-enabled 네트워크에서, PAN 코디네이터 뿐 아니라 어떤 코디네이터든, 비콘을 보내거나 자체 슈퍼프레임을 만들기 위한 옵션을 가지고 있다. 
   그림 3.8은 같은 네트워크 상의 PAN 코디네이터와 다른 코디네이터 모두 비콘을 보낼 때 요구되는 시간을 보여준다.
   코디네이터는 오직 PAN 코디네이터 슈퍼프레임의 비활동 주기동안에만 자체 비콘 전송을 시작할 수 있다.
   PAN 코디네이터 비콘은 수신된 비콘으로 불려진다.
   다른 어떤 코디네이터의 비콘은 전송 비콘으로 알려져 있다.
   두 슈퍼프레임의 활동 주기는 동일한 길이를 가져야 한다.
   PAN 코디네이터이외의 다른 코디네이터는, 오직 자체 슈퍼프레임의 시작을 특정하는 비콘만 보내고, 그리고 슈퍼프레임의 끝은 PAN 코디네이터의 슈퍼프레임의 끝과 동일할 수 있다.
   
   만약 장비가 긴 기간의 시간 동안 자체 GTS를 사용하지 않는다면, 해당 GTS는 만료될 것이고 코디네이터 다른 장치에 특정 GTS를 할당 할 수 있다.
   GTS 만료를 초래하는 비활동 주기는 항상 슈퍼프레임 길이의 두배이다. 이 정수 배의 값은 macBeaconOrder에 따른다.
   
![image](https://user-images.githubusercontent.com/43804441/52517841-cc83b680-2c84-11e9-8204-615796489c10.png)

![image](https://user-images.githubusercontent.com/43804441/52517845-e9b88500-2c84-11e9-9c3f-be2755353b41.png)

  
  예를 들어, 만약 4번의 연이은 슈퍼프레임 동안 7의 macBeaconOrder의 장비가 자체 GTS를 사용하지 않는다면, 그 GTS는 만료될 것이다.
  
## THE Interframe Spacing  
  
![image](https://user-images.githubusercontent.com/43804441/52517872-7a8f6080-2c85-11e9-9e24-f59475a9a508.png)

   
  한 장비에서 다른 장비로 데이터를 전송하는 동안, 송신 장비는 수신장비가 다음 프레임이 도착하기 전에 
  수신된 프레임을 처리할 수 있도록 연속적인 프레임전송 사이에 잠시 기다려야만 한다.
  이는 IFS,프레임 공간이라고 알려져 있다.
  IFS의 길이는 전송되는 프레임의 사이즈에 달려있다.
  aMaxSIFSFramesSize (a MAC constant with default value of 18 octets)와 동일하거나 적은 사이즈의 MPDU들은 작은 프레임으로 고려된다.
  긴 프레임은 aMaxSIFSFramesSize의 크기를 초과하는 MPDU이다.
  
  짧은 프레임이후의 대기 기간은 shortIFS (SIFS)라고 불리운다. SFIS의 최소 값은 macMinSIFSPeriod이다.
  비슷하게 긴 프레임은 LongIFS(LIFS)이고 macMinLIFSPeriod의 최소 값을 가진다.  
   macMinSIFSPeriod과 macMinLIFSPeriod은 12개 및 40개의 기호이다.
   
   그림 3.9는 두 가지 시나리오의 인터프레임공간을 보여준다.
   첫 번째에서 메세지는 인정되며, 프레임 길이에 따라서 수신된 프레임과 다음 프레임 사이의 대기 시간이 SIFS or LIFS이다.
   프레임 전송 및 수신 프레임의 수신에 따른 시간을 t(ACK)로 표시한다.
   만약 확인이 필요하지 않는다면, 최소 인터프레임 간격은 프레임이 전송되는 순간부터 시작된다.
   

## CSMA-CA

    
   CSMA-CA는 802.15.4에 의해 지원되는 채널 접근 매커니즘이다.
   CSMA-CA에서, 장비가 송신을 원할 때면, 채널이 다른 장비에 의해 사용 되지 않는 것을 보장하기 위하여 CCA를 수행한다.
   장비는 자체 신호로 전송을 시작하다. CSMA-CA에 관한 간단한 내용은 내 깃허브의 LAB 폴더의 다른 MD파일을 참조하면 확인이 가능하다.
   
   비콘 전송외에 CSMA-CA를 사용하지 않고 장비가 채널에 접근하는 경우는 2가지가 더 있다.
   
        * contention-free period (CFP)동안 채널에 접근할 때.
        
        * 데이터 요청 명령을 승인한 직후 즉시 전송한다. 즉, 만약 장비가 코디네이터로부터 데이터를 요청하는 경우, 코디네이터는
        경쟁 접근 기간 (CAP)동안에도 이 두 송신간 CSMA-CA를 수행하지 않고 바로 그 후에 데이터를 송신하다.
        
   CSMA-CA에는 슬롯과 언슬롯 두가지 타입이 있다.
   슬롯 CSMA-CA는 슈퍼프레임 구조가 있는 동안 CSMA-CA를 수행하는 것을 말한다.
   슈퍼프레임은 활동 기간을 16개의 동일한 시간 슬롯으로 나눈다. CSMA-CA알고리즘의 백오프 기간은 특정한 시간 슬롯으로 맞추어 져야한다.
   
   언슬롯 CSMA-CA알고리즘은 슈퍼프레임 구조가 없을 때 사용된다.
   결과적으로 백오프 슬롯 정렬은 필요가 없다. nonbeacon-enabled 네트워크는 항상 언슬롯 CSMA-CA 알고리즘을 채널 접근으로 사용한다.
   
   만약 CCS가 사용 중인 채널을 표시하면, 장비는 랜덤한 시간 주기동안 백오프 될 것이고 다시 시도할 것이다.
   이 슬롯과 언슬롯 CSMA-CA의 랜덤한 백오프 주기는 단위 백오프 기간의 정수 배이다. 
   이 단위 백오프 기간은 aUnitBackoffPeriod (a MAC constant) 기호와 같다.
   
   
![image](https://user-images.githubusercontent.com/43804441/52518288-c47b4500-2c8b-11e9-84a0-56cf47e823ba.png)

   
   
   그림 3.10은 CSMA-CA 알고리즘의 흐름도를 보여준다.
   알고리즘의 첫 단계에서, 결정은 슬롯 혹은 언슬롯 CSMA-CA를 사용하여 만들어진다.
   CSMA-CA알고리즘에서는 3가지 변수가 사용된다.
  
        the back-off exponent (BE), 
        the number of back-offs (NB),
        the contention window (CW) length.
   
   알고리즘이 사용중인 채널을 마주할 때마다, 랜덤한 시간 동안 백오프 되고 BE는 이 랜덤한 기간동안 허용된 범위를 결정한다.
    
   이 랜덤한 백오프는 단위 백오프 기간에 의한 0과 2^BE-1 사이의 정수의 배이다.

![image](https://user-images.githubusercontent.com/43804441/52518293-d2c96100-2c8b-11e9-99b0-b5c167913b51.png)
   
   BE의 초기 값은 언슬롯 CSMA-CA 채널 접근의 macMinBE와 동일하다.
   슬롯 CSMA-CA에서, 슈퍼프레임 구조의 배터리 라이프 확장(BLE) 옵션의 선택은 BE 값에 영향을 미친다.
   만약 BLE옵션이 활성화되면, 코디네이터는 배터리 절약을 위하여 비콘 프레임 전송에 따른 macBattLifeExtPeriods와 같은 기간후에 수신기를 종료한다.
   이 경우 백오프 기간의 범위는 2와  macMinBE의 더 작은 값으로 최소화 된다.
   
   BE = min(2,macMinBE)
   
   만약 BLE 옵션이 선택되지 않으면, 코디네이터는 전체 CAP동안 활성화 되고, BE의 값은  (언슬롯 CSMA-CA와 비슷하게) macMinBE와 같다.
   BE의 값은 CCA가 수행되고 채널이 사용 중일 때마다 증가한다. 그러나 BE의 값은 macMaxBE를 초과할 수 없다.
   
   NB는 장비가 백오프되고 채널 접근 매커니즘을 재시도하는 횟수를 추적하는 카운터이다.
   알고리즘의 시작에서 NB는 0이고 장비가 사용 중인 채널을 만나 백오프 될 때마다, BE는 증가한다.
   만약 NB가 macMaxCSMABackoffs에 도달하고 채널이 여전히 접근이 불가능하면, CSMA-CA 알고리즘은 종료하고 NWK층으로 채널 접근 실패를 보고한다.
   
   경쟁 윈도우 CW 변수는 전송 시작 전에 채널을 사용할 수 있어야 하는 백오프 기간을 결정한다.
   예를 들어, 만약 CW가 2와 같다면 기기는 2회 연속적인 백오프로 인해 가용 채널이 생긴 후에만 전송을 시작한다.
   CW는 오직 슬롯 CSMA-CA 알고리즘에서만 사용된다.
   
   만약 전송이 허용된 시간동안 완료되지 못 한다면, MAC 다음 CAP이 시작될 때까지 기다리고 CSMA-CA채널 접근 알고리즘을 다시 시도한다.
   
   
### Hidden and Exposed Node Problems
    
   csma-ca 알고리즘의 한가지 취약점은 숨겨진 지국 문제이다.
   이 것은 lab 폴더의 다른 md 파일에서 확인이 가능하므로 해석은 넘어가도록 하겠다.
    
   또 다른 취약점인 노출된 지국 문제 역시 넘어가도록 하겠다.
    
    
    
## MAC Service

   MAC 계층은 MAC 데이터 서비스와 MAC 관리 서비스, 두 가지의 서비스를 제공한다.
   MAC 데이터 서비스는 MAC Common Part 부계층 SAP( MCPS-SAP)를 통하여 NWK층 데이터 객체인 NLDE에 의하여 접근될 수 있다.
   MAC 관리 서비스는 MLME-SAP를 통하여 접근된다.
   
   전기능 장비FFD는 MAC 데이터 서비스 전체를 구현해야 하지만 FFD에 대해서는 선택사항인 MAC 관리 서비스에는 일부 기능이 있다.
   MAC 데이터와 관리 서비스 모두에서 FFD에는 필요하지만 기능 감소 장비(RFD)에는 선택적인 기능이 다수 존재한다.
   RFD에 대한 옵션 기능(서비스 프라이머)은 IEEE 802.15.4 표준문서 [2]에 다이아몬드( ♦ )로 표시된다. 
    FFD와 RFD 모두에 대해 선택 가능한 기능은 별표로 표시한다.
   
   
### MAC DATA Service

   MAC는 NKW층으로 데이터 서비스를 제공한다. 전송되어야할 데이터는 NPDU로 제공된다. NPDU는 MSDU의 페이로드에 있다.
   NWK는 MCPS-SAP를 통해 데이터 전송을 위한 요청을 만들고 NPDU를 제공한다.
   
   장치의 서로 다른 MSDU를 추적하기 위해, 각 MSDU는 고유한 MSDU 핸들로 이루어진다.
   msduhandle은 MSDU를 식별하는 정수다. 
   예를 들어, 한 MSDU를 전송 큐에서 제거해야 할 경우, MAC 부계층은 대기열에서 해당하는 msduhandle을 찾으려고 시도한다.
   
   데이터 순서 번호 DSN은 msduhadle로서 사용될 수 있다. dsn은 MAC-PIB에 저장된 MAC 속성이다.
   macDSN의 초기 값은 임의의 수이다.
   데이터 프레임 또는 MAC 명령 프레임이 생성될 때마다 MAC 부계층은 macDSN의 값을 나가는 프레임으로 복사하고 macDSN을 하나씩 증가시킨다.
   
   여기에는 데이터 전송을 위한 3가지 옵션이 있다.
   
   
   * 승인 혹은 승인되지 않은 전송 
     승인된 전송에서 송진 장치는 데이터가 성공적으로 수신되면 데이터 수신장비가 수신 확인 프레임을 다시 보내도록 요청한다.
     승인되지 않은 전송에서 데이터 수신자는 승인을 다시 전송하지 않는다.
     일반적으로, 승인을 보내는 것은 선택적이고 데이터 수신 장비는 메세지 송신자가 요청 하지 않는 한 승인을 다시 보내지 않는다.
     
   * GTS 또는 CAP 동안 전송
     nonbeacon-enabled 네트워크에서, 이 전송 옵션은 비컨이 가능한 네트워크에서는 gts가 없기 때문에 항상 cap이다.
     
   * 직접 혹은 간접 전송
     이름처럼, 간접전송에서 데이터는 수신장비에 직접 전송되지 않는다.
     대신에 비콘 가능 네트워크에서 데이터는 코디네이터에 저장할 수 있고, 수신자 장비는 코디네이터에 보류 중인 데이터가 있다고 알린다.
     이 알림은 정기적으로 전송되는 비콘 메세지의 일부이다.
     알림을 받은 이후에 장비는 데이터 요청을 코디네이터에게 보내 데이터가 전송되도록 한다. 오직 코디네이터만이 간접 송신을 관리할 수 있다.
     
   MSDU는 NWK 층으로부터 요청이 있다면 전송 큐에서 제거될 수 있다.
   MAC 부계층은 단순히 MSDU와 관련된 masduhandle을 찾고 그것이 전송이 아직 되지 않았으면 큐에서 삭제하다.
   
   앞서 말한 데이터 서비스는 데이터 전송을 원하는 장비를 위한 것이었다.
   만약 장비가 데이터르 수신하고 있는 경우, MAC 데이터 서비스는 NWK층으로 데이터를 전달한다.
   데이터 자체 이외에 MPDU 수신중 측정된 LQI와 데이터가 수신된 시간은 NWK층으로 제공된다.
   
 
 ### THE MAC Management Service
 
   MAC 관리 서비스는 MLME-SAP를 통하여 접근된다.
   MAC 명령은 일반적으로 주소지정 및 보안 필드와 같은 매개 변수를 포함 하고 있으며, 다음 상위 계층으로 상태 형식의 요청 결과를 보고한다.
   상태는 성공 혹은 인식 불가와 같은 몇 가지 옵션으로 가능하다.
   
 ### Managing MAC PID
 
   MAC 층은 물리 계층과 비슷하게 자체의 상수와 속성을 갖는다. MAC 속성은 MAC-PIB에 저장되고 NWK층에서 접근 가능합니다.
   
   NWK층 MAC-PIB 로부터 속성의 값을 얻기 위하여 MLME를 요청할 뿐만 아니라, PHY-PIB 로 부터의 속성 값을 요청한다.
   후자의 경우 MLME는 단순히 요청을 PLME에 전달하고 PLME로 부터 결과를 받으면 NWK로 알립니다.
   
   NWK 계층은 MLME-SAP를 통해 MAC-PIB 또는 PHY-PIB 속성을 주어진 값으로 설정하도록 MLME에 요청할 수 있다.
   NWK 계층은 MAC 또는 PHY PIB의 읽기 전용 속성을 변경할 수 없다.
   PHY-PIB의 속성을 변경하라는 NWK 요청은 MLME에 의해 PLME-SAP를 통해 PLME로 전달된다.


### MAC reset

  NWK 층은 MAC 부걔츠을 초기 조건으로 리셋하고 내부 변수를 자체 디폴드 값으로 클리어 하기 위하여 MLME를 요청할 수 있다.
  이는 MAC reset operation으로 알려져 있다.
  NWK층은 또한 MAC-PIB의 모든 속성들의 값을 자체 초기 값으로 리셋하기 위한 요청할 수 있는 옵션을 가지고 있다.
  MAC는 내부 변수와 속성을 리셋하기 전에 전송을 불가능하게 하기 위하여 PHY 관리 서비스를 사용한다.
  

### Device Association and Disassociation

  연결은 장비가 네트워크에 가입하기 위한 절차이다.
  MAC 층은 NWK층에 대한 서비스로서 연결 절차를 제공한다.
  네트워크 형성을 관리하는 것은 NWK 층이다.
  대부분의 경우, 기기는 연결 절차를 시작하기 전에 MAC 리셋을 수행하여야 한다.
  
  이 절에서, 연결 절차는 서비스 기본요소가 어떻게 계층을 능력을 설명하는 도움이 되는 지에 관한 예로서 서비스 기본요소를 사용하여
  연결 절차를 설명할 것이다.
  MAC 연결 절차를 위해서는 4가지 서비스 기본요소가 있다.
  
  MLME-Associate.request
  MLME-Associate.indication
  MLME-Associate.response
  MLME-Associate.confirm
  
  표시 및 반응 연결 서비스 요소는 RFD를 위한 옵션이다.
  
  MLME-Associate.request는 코디네이터 가입을 요청하는 장비의 NWK층에 의하여 사용된다.
  이 요청은 또한 네트워크 가입 요청을 하는 장비의 기능 목록도 제공하다.
  예를 들어, 이 목록은 FFD 또는 RFD와 관계 없이 결정된다.
  전체 목록은 좀 더 밑에서 다룰 것이다.
  
  네트워크 가입을 원하는 장비의 MAC 층은 자신의 NWK층으로 부터 연결 요청을 받을 때, MPDU로서 명령을 물리계층으로 전달 한다.
  MPDU는 PHY 페이로드가 되고 코디네이터 장비로 라디오에 의하여 전송된다. 
  코디네이터 응답이 장비로 되돌아 오면, 장비의 MAC는 요청 결과에 관한 확인 ( MLME-Associate.confirm ) 을 NWK층으로 전달한다.
  
  코디네이터 측에서 코디네이터의 MAC가 연결 요청을 받으면, MLME-Associate.indication기본요소를 사용하여 요청을 코디네이터의 NWK층에 알린다.
  코디네이터의 네트워크 층은 MLME-Associate.response 기본요소를 사용하여 자신의 MAC 계층에 결정을 전달한다.
  
  코디네이터 MLME 연결되지 않은 장비로 결정을 직접 전달하지 않는다.
  대신에 코디네이터 MLME는 간접 전송을 사용한다. 그래서 데이터는 코디네이터에 저장된다.
  연결되지 않은 장비는 장비가 연결 요청을 보낸 순간부터 미리 정해진 기간의 시간을 기다린 후에 코디네이터에게 데이터 요청을 전송한다.
  이 요청 대기 시간의 길이는 MAC-PIB에 속성(macResponseWaitTime)으로서 저장 된다.


![image](https://user-images.githubusercontent.com/43804441/52519237-8e45c180-2c9b-11e9-936c-38def6644698.png)


  연결된 절차는 3.12그림에 나타난다.
  MLMECOMM- STATUS.indication 기본요소는 성공 또는 실패의 전송 상태를 NWK층에 제공한다. 
  네트워크에 성공적으로 연결되면 장비에 알려진다.
  
  분리는 관련 장비가 코디네이터에게 장비가 네트워크를 떠날 의도가 있음을 알리는 절차이다.
  연결된 장비의 NWK층은 MLME-DISASSOCIATE-request기본요소를 사용하여 자신의 MLME에게 분리 요청을 발생시킨다.
  이 요청은 PHY데이터 서비스를 이용하여 코디네이터로 전송된다.
  연결 해제 요청에서, 장비는 요청의 이유를 제공한다.
  그 이유는 다음 중 하나일 수 있다.
  
  * 코디네이터가 장비가 PAN으로 부터 떠나기를 원한다.
  * 장비가 PAN으로 부터 떠나길 원한다.
  

  코디네이터 MLME는 요청을 분석하고 만약 요청의 모든 주소지정과 보안 필드가 유효하다면, 코디네이터 MLME는 해제 성공의 확인을 장비에게 재전송한다.
  이 확인은 직접 혹은 간접 매커니즘을 통해 장비로 재전송될 수 있다. 선호하는 전송 방법은 MEMLE-DISASSOCIATE.request에 명시되어 있다.
  
![image](https://user-images.githubusercontent.com/43804441/52530659-fe138500-2d4b-11e9-9370-5aa368690b95.png)  
  
  코디네이터 MLME는 MELME-DISASSOCIATE.indication 기본 요소를 사용하여 네트워크 내의 장비로부터 수신된 해제 요청의 결과에 대해 NWK 층에 통지한다. 그림 3.13은 해제 절차에 대한 순서 표이다.
  
  해제 요청은 장비나 코디네이터에 의해 시작 될 수 있다. 그림 3.13 a는 장비가 해제 절차를 시작할 때 발생하는 순서를 보여준다.
  만약 비콘 사용 네트워크에서 코디네이터가 해제를 시작 할 경우, 직접 전송이 사용될 수 있다.
  그림 3.13b에서 코디네이터는 주기적으로 방송되는 비콘의 부분으로 장비에 보류 중인 데이터가 있다는 것을 알린다.
  비콘을 수신할 수 , 장비는 데이터를 요청하고 해제 연결을 수신한다.
  MLME-DISASSOCIATE.confirm 은 항상 분리를 요청한 장비의 NWK층이 요청의 결과를 할 수 있도록 하기 위하여 사용된다.
  

### COMMUNICATION STATUS

  MLME는 NWK층에게 전송상태와 같은 정보를 제공하기 위하여 MLME-COMM-STATUS.indication 기본요소를 사용한다.
  이 기본요소는 수시된 패킷의 보안과 관련된 에러를 보고하기 위하여 MLME에 의하여 사용 되기도 한다.
  만약 통신이 성공적이지 못하면, 이 기본요소는 실패의 원인를 보고한다.
  지원되지 않는 보안 기능이나 채널 접근 실패는 비성공 통신 원인의 예이다.
  

### Enabling and Disabling the Receiver

   NWK 층은 MLME에게 일정한 시간 동안 수신기가 활성화하도록 요청 할 수 있다.
   수신기가 계속 겨켜 있을 기간은 NWK층에 의해 제공된다. NWK층은 또한 수신기의 전원을 끄도록 요청 할 수 있다.
   이는 FFD와 RFD 모두의 선택적 기능이다.
   
   활성과 비활성 요청은 다른 MLME 책임에 보조적인 것으로 처리된다.
   예를 들어, 만약 MLME가 비콘 전송과 같은 상충되는 책임을 가진다면, MLME는 수신기를 종료하라는 NWK층의 요청을 무시할 것이다.
   MLME는 항상 수신기를 활성 혹은 비활성하도록 요청한 결과를 NWK층에 알려준다.
   

### GTS MANAGEMENT

   비콘 가능 네트워크에는, 장비가 CSMA-CA를 사용하지 않고 전송을 할 수 있는 GTS가 있다.
   네트워크 층의 장비는 새 GTS의 할당을 요청하기 위해서 MAC 관리 서비스를 사용할 수 있다.
   만약 장비가 이미 할당된 GTS를 가지고 있거나 더 이상 필요하지 않는다면 MLME는 PAN 코디네이터에게 GTS 할당을 중간할 것을 요청 할 수 있다.
   PAN 코디네이터의 NWK층은 자체 MLME를 요청하여 네트워크에서 장치에 할당된 기존 GTS의 할당을 취소할 수 잇따.
    
   PAN 코디네이터는 GTS 요청을 승인하거나 거부하기 위한 옵션을 가지고 있다.
   만약 PAN 코디네이터가 GTS 할당을 승인한다면, PAN 코디네이터는 GTS 길이와 같은 특성을 응답에 포함시킨다.
   GTS 요청 기본요소는 MLME-GTS.request이며 nwk층에 의하여 MLME에 발급된다.
   MLME는 MLME-GTS.confirm을 사용하여 GTS 재요청의 결과를 NWK층에 다시 전달한다.
   PAN 코디네이터에서 MLME는 PAN 코디네이터가 네트워크 내의 어떤 장치로 부터 요청을 수신한 것에 기초한 GTS중 하나를 
   할당하거나 하지 않을 때마다 MLME-GTS.indication 기본요소를 사용하여 NWK층에게 알린다.
   만약 NWK 층이 GTS 할당 또는 반환을 요청한 경우, 해당 MLME는 MLME-GTS.confirm 기본요소를 사용하는 nwk층에 알릴 것이다.
    

![image](https://user-images.githubusercontent.com/43804441/52530940-26ea4900-2d51-11e9-8531-a15a36208b1d.png)

   그림 3.14는 장비에 의하여 GTS 할당이 시작될 때 동안 순서표를 나타낸 것이다.
   그림 3.15는 두 가지의 다른 반환에 관한 시나리오를 나타냈다.
   그림 3.15a는 장비가 요청을 개시할 때, 반환 절차이다. 그림 3.15b에서 PAN 코디네이터가 시작점이다.

![image](https://user-images.githubusercontent.com/43804441/52531026-3a49e400-2d52-11e9-9ffc-7553e1e149ef.png)

   GTS의 반환은 CAP에서 사용되지 않는 간격을 남길 수 있다. 
   예를 들어, 그림 3.16에서 GTS2는 반환되고 타임슬롯 11부터 13은 어떤 장비에서도 더 사용되지 않는다.
   이것은 조각난 슈퍼프레임이라고 알려져있다. 
   이런 단편화 문제를 해결하고 CAP를 늘리기 위하서, GTS2는 제거되고 GTS3는 타임슬롯 12와 13에 간단히 재할당 되어야한다.
   GTS할당의 결과로 CAP는 타임 슬롯 9부터 12슬롯 까지 증가해야한다.
   
    
### Updating Superframe Configuration

   비콘 가능 네트워크에서, nwk 층은 슈퍼프레임 구조를 시작하기 위하서 MLME를 요청할 수 있다.
   NWK층은 활성 기간의 길이와 비콘이 전송되어야하는 빈도를 포함하되, 이에 한정되지 않는 필수적인 매개 변수를 제공한다....???
    
   슈퍼프레임 배열에서 한 가지 매개 변수는 BLE 옵션이다.
   이 옵션은 비코닝 코디네이터가 배터리 에너지를 아끼기 위해서 해당 비콘 프레임 전송이 끝난 후에 macBattLifeExtPeriods와 동일한 
   시간 주기동안 수신기를 끄는 것을 허락할 수 있다.
   이 기간은 프레임을 전송한 후 필요한 IFS 기간을 더한 것이다.
   만약 BLE 옵션 설정이 실패하면, 비코닝 코디네이터는 전체 CAP동안 자체 수신기를 활성화 시킬 것이다.
   
### Orphan Notification

   장비는 네트워크 내의 다른 장비와 통신을 하기 위해서 네트워크와 연결되어야만 한다.
   이전에 네트워크에 연결되어 있었지만, 연결이 끊긴 장비는 고아 장비로 간주한다.
   해제 절차를 이용하여 네트워크를 떠난 장비는 고아 장비로 고려되지 않는다.
   만약 장비의 NWK층이 반복된 통신 실패를 마주한다면, 장비가 고아가 되었다는 것으로 결론 지을 것이다.
    
   예를 들어 만약 장비가 확인을 요청한느 프레임을 전송하고 macAckWaitDuration 기호만큼을 기다린 후에도 확인을 받지 못한다면,
   장비는 macMaxFrameRetires까지 데이터 전송을 반복할 것이다. 
   만약 macMaxFrameRetires 초과의 시도 후에도 여전히 확인을 받지 못 한다면 장비는 이것을 한 번의 통신 실패로 카운트 할 것이다.
   응용 프로그램 개발자는 장치를 고아로 선언하기 전에 허용할 통신 장애 수를 결정한다.
   고아 장치의 NWK 계층은 MLME에 다음 절차 중 하나를 수행하도록 지시할 수 있다.
    
     * MAC 리렛 그리고 연결 절차 수행
     
     * 고아 장비 재배치 절차 수행

![image](https://user-images.githubusercontent.com/43804441/52531282-1ab4ba80-2d56-11e9-8652-6eceab1f0995.png)


   리셋과 연결 절차는 위에 나와 있다.
   재배치 절차는 (그림 3.18) 코디네이터에게 고아 알림 명령을 보내는 장치로 시작한다. 
   코디네이터의 MLME는 MELME-ORPHAN.indication 기본요소를 사용하여 고아장비의 존재를 NWK층에 알린다.
   
   코디네이터의 NWK층은 고아 장비의 주소를 확인하고,MLME-ORPHAN.reponse 기본요소를 사용하여 장비가 이전에도 이 코디네이터에 연결되어있었는지를 
   확인한다.
   
   만약 장비가 이전에도 코디네이터에 연결되었다면, 코디네이터의 MLME는 재배치 명령을 고아 장비에게 보낸다.
   이 재배치 명령은 네트워크 세팅을 전달하는데 사용된다. 고아 장비에게 명령이 성공적으로 전달 될 때, MLME는 MLME-COMM-STATUS.indication
   기본요소를 사용하여 그 성공을 NWK층에 알린다.
   
   만약 장비가 코디네이터와 연결되지 않는다면, 코디네이터의 MLME는 어떤 행동도 수행하지 않는다.
   고아 장비는 macResponseWaitTime만큼 기다리고, 만약 더 이상 어떤 재배치 명령도 없다면, 고아 장비는 어떠한 코디네이터도 범위에 없어서
   연결 될 수 없다고 추측한다.
   
   
### Channel Scannig
   
   채널 스캐닝 용량은 nwk층에게 MAC층의 서비스로서 제공되어진다.
   채널 스캔은 장비의 personal perating space(POS)를 포함한 활동에 관한 정보를 제공한다.
   여기에는 4가지 타입의 채널 스캔이 있다.
   
   * ED scan :
            각 채널의 에너지 레벨이 phy 에너지 탐지 서비스에 의해 결정된다. ED 스캔은 RFD의 옵션이다.
   
   * 고아 스캔 : 
            만약 장비가 고아라면, 현재 연결을 위한 PAC을 찾는다.
            고아 스캔에서 MLME는 고아 알림을 각 채널의 코디네이터에게 보내고 코디네이터로부터 재배치 명령을 기다린다.
            기기가 재배치 명령을 수신하면 수신기를 비활성화하여 검색을 중단한다. 그렇지 않으면 장치는 목록의 다음 채널로 계속 이동한다.
   
   * 활성 스캔 :
            이런 유형의 스캔에서 MLME는 먼저 신호 요청 명령을 전송한다. 그리고 그 장치는 수신자가 정보를 기록할 수 있게 한다.
            활성 스캔은 자체 네트워크를 구축하여 POS에서 다른 네트워크가 사용하는 모든 PAN 식별자를 발견하고
            자체 네트워크에 대한 고유한 PAN 식별자를 선택하려는 코디네이터에 의해 사용될 수 있다. RFD의 경우 활성 스캔 기능은 선택사항이다.
            
    * 패시브 스캔 :
            패시브 스캔에서는 , 활성 스캔과 대조적으로, 비콘 요청 명령 전송이 없다.
            MLME는 수동 스캔 요청을 수신한 직후 수신기를 활성화하고 수신한 정보를 기록하기 시작한다.
            패시브 스캔은 해제 장비가 연결 절차의 부분으로서 코디네이터를 찾기 위해 사용 될 수 있다.

### Beacon Notification

   장비가 비콘을 수신할 때, 만약 비콘이 페이로드를 가지거나 자동 탐색 특성이 0으로 설정되어 있는 경우, MLME는 비콘 프레임에 포함된 매개변수를 
   NWK층에 보내야 한다.
   수신된 비콘 프레임의 LQI 값과 시간은 NWK층으로 전달된다. 비콘 알림을 수행하는 기본 요소는 MLME-BEACON-NOTIFY.indication이다.
    
### Synchronizing with a Coordinator

   비콘 가능 네트워크에서 장비의 NWK층은 MLME-SYNC.request 기본요소를 사용해서 장비를 코디네이터와 동기화시키기 위해서 MLME를 요청한다.
   장치는 한 번만 또는 연속적으로 비콘을 추적하도록 선택할 수 있다. 
   비콘 추적에서 이 장치는 신호기의 예상 도착 시간 직전에 주기적으로 수신기를 작동시킨다.

![image](https://user-images.githubusercontent.com/43804441/52531490-995f2700-2d59-11e9-8038-572a6a51620d.png)


   만약 장비가 코디네이터와의 동기를 잃어버린다면, NWK층은 MLMESYNC-LOSS.indication 기본요소를 사용하여 동기 분실에 관한 것을
   코디네이터에게 알리기 위하여 MLME를 요청한다.
   장치는 MaxLostBeacons(기본값이 4인 MAC 상수) 기간 동안 비콘을 수신하고 비콘을 탐지하지 않으면 코디네이터와의 동기화를 상실했다고 결론짓는다.
   그림 3.19a는 기기가 비콘 위치를 찾으려고 하지만 추적하지는 않을 때를 보여주는 순서 차트다.
   비콘 추적 시퀀스 차트는 그림 3.19b 에 나타나 있다.
    
 ### Requesting Data from a Coordiantor
    
   코디네이터는 그것의 정기적인 비컨 프레임 전송을 사용하여 네트워크 내의 장치에 코디네이터에 보류 중인 데이터가 있음을 통지할 수 있다. 
   기기가 보류 중인 데이터에 대해 통지되면 기기의 NWK 계층은
   MLME(MLME-POLL.request premary 사용)에 데이터 요청을 코디네이터에게 전송하도록 요청한다.
   이 원시성은 비컨이 가능한 네트워크와 비컨이 가능한 네트워크 모두에서 코디네이터에게 데이터를 요청할 수 있다.
   
![image](https://user-images.githubusercontent.com/43804441/52531533-2c985c80-2d5a-11e9-8caf-eb9c1192babf.png)

   장치는 macMaxFrameTotalWaitTime 기호의 일정 기간 동안 데이터를 기다린다. 
   이 기간 동안 MLME가 데이터를 수신하지 않을 경우, MLME-POLL.confirm을 사용하여 수신한 데이터가 없음을 NWK 레이어에 통지한다.

   그림 3.20에는 두 가지 데이터 폴링 시나리오가 표시된다. 
   첫 번째 경우 장치는 데이터를 요청하고 코디네이터는 보류 중인 프레임이 없음을 나타내는 수신확인을 다시 보낸다(FP  0). 

   보류 중인 프레임이 있는 경우(FP  1), 데이터는 수신 프레임을 따른다.

   데이터 수신 장치의 MLME는 MAC 데이터 서비스의 MCPS-DATA.표시 원시적인 방법으로 데이터를 NWK 계층으로 전송한다.


## THE MAC Frame Format

   802.15.4는 비콘 프레임, 데이터 프레임, 승인 프레임, MAC 제어(명령)프레임 4개의 MAC 프레임 구조를 정의한다.
   
   
![image](https://user-images.githubusercontent.com/43804441/52565013-f259b880-2e48-11e9-9bba-53c587dded54.png)

   
### general MAC Frame Format

   일반적인 MAC 프레임은 그림 3.21a에서 보여지는 것과 같고 MAC 헤더(MHR), MAC 페이로드, MAC 푸더(MFR) 3가지 부분으로 이루어진다.
   각 필드는 그림에서 보여지는 바이트(옥텟) 사이즈이다.
   
   첫 번째 필드는 컨트롤 프레임으로 앞서 말한 4가지 구조 중 한 가지로 프레임 타입을 정의한다.
   만약 보안가능 부필드가 1로 설정되면, 이 프레임은 보안적으로 보호되며 보조 헤더는 MAC 프레임의 부분이 될 것이다.
   그렇지 않으면 보조 헤더의 크기는 0이다.
   부필드가 보류 중인 프레임은 간접 데이터 전송방식의 일부로 사용되며, 만약 이것이 1로 설정되면,
   전송 장비에서 수신 장비를 위한 보류 중인 데이터가 있다는 것을 의미한다.
   만약 승인 요청 하위 필드가 1로 설정되면, 수신 장비는 승인 프레임을 재전송해야한다.
   
   같은 PAN안에서 통신이 이루어질 때, PAN 식별자는 소스 및 목적지 장비 모두에서 동일 할 것이므
   두 식별자를 한 프레임내에서 반복할 필요는 없다.....???????????????
   PAN ID 압축 하위 필드는 PAN 식별자의 불필요한 반복을 피하도록 도와준다.
   PAN ID 압축(Compression) 필드가 1로 설정되면, 오직 목적지 PAN 식별자만이 프레임에 포함될 것이고, 발신지 PAN 식별자는 목적지와 같다고 가정한다.
   
   목적지/발신지 주소지정 모드 부필드는 주소지정 모드를 16비트 짧은 주소 또는 64비트 확장 주소로 결정한다.
   MAC 프레임에서 목적지와 주소 필드의 길이는 주소 지정 모드에 의하여 결정된다.
   
   다음 부필드는 프레임 버전이다.
   802.15.4 표준은 업데이트 되어질 수 있으며, 프레임 버전 부필드는 프레임 구성에 사용되는 802.15.4의 버전을 결정한다.
   
   MAC 프레임의 2번째 필드는 순서 번호이고, 비콘 순서 넘버 BSN 또는 데이터 순서넘버 DSN을 포함할 수 있다.
   순서 번호를 하는 것은 다양한 순서를 구별하는 것에 도움이 된다.
   예를 들어, 만약 동일한 순서 번호의 2 프레임이 수신되면, 같은 프레임이 재전송되었다는 것을 의미한다.
   첫 번째 프레임이 성공적으로 탐지되면, 동일한 순서번호의 두 번째 프레임은 무시될 수 있다.
   
   BSN이나 DSN의 값은 MAC-PIB 속성으로서 저장되어진다.
   BSN은 비콘 프레임에서만 사용된다. DSN은 비콘프레임이 아닌 어떤 프레임에서도 사용된다.
   장비는 macDSN 값을 랜덤한 수로 초기화하고 각 전송 후 마다 증가 시킨다.
   
   보조 보안적 헤더는 MAC 프레임에서 선택적인 필드이고 보안 레벨과 같은 정보와 맥 프레임을 보호하는데 사용되는 보안 키의 타입을 포함한다.
   (아래에서 추가적으로 설명이 나올 것)
   MAC 프레임의 마지막 필드는 프레임 체크 순서 FCS필드이고 수신 장비는 수시된 프레임의 FCS를 이용하여 가능한 에러를 체크한다.
   

### THE Frame Check Sequence

   802.15.4는 데이터 패킷의 가능한 에러를 찾기 위하여 itu의 CRC에 기반한 16비트 FCS를 사용한다.
   
   CRC의 기본적 개념은 LAB 폴더의 물리층.MD 혹은 데이터링크층.MD 파일을 찾아보면 된다.

![image](https://user-images.githubusercontent.com/43804441/52566645-a65d4280-2e4d-11e9-8653-e21705056431.png)
   
### THE MAC Beacon Frame Format

  그림 3.23에서 보이는 비콘 프레임은 일반적 MAC 프레임 포맷의 특별한 형식이다.
  순서 번호 필드는 macSDN의 현재 값을 포함한다.
  
  슈퍼 프레임 사양 필드는 MAC 페이로드의 일부이고, 부필드는 그림에서 나온 것과 같다.
  비콘 오더 BO 부필드는 비콘 사이의 전송간격을 결정한다. BO와 BI의 관계는 위에서 설명했다.
  슈퍼프레임 오더 SO는 슈퍼 프레임의 활동 기간을 특정한다.
  슈퍼프레임은 동일한 16개의 타임슬롯으로 나뉘어지고, 마지막 CAP 슬롯 부필드는 CAP의 마지막 타임슬롯을 결정한다.
  만약 CAP 이후에 어떤 타임 슬롯도 없다면, GTS로서 사용될 것이다.
  
  만약 BLE 부필드가 하나로 서정되면, 비콘닝 장비가 배터리 절약을 위하여 특정한 시간의 주기 이후 수신을 종료할 것을 의미한다.
  
  만약 이 비콘 프레임이 PAN 코디네이터에 의해 전송된 것이라면, PAN 코디네이터 부필드는 1로 설정될 것이다.
  이는 PAN코디네이터로부터 수신된 프레임과 같은 네트워크의 다른 코디네이터로부터 수신된 프레임을 구별하는데 도움이 될 것이다.
  슈퍼프레임 사양필드의 마지막 비트는 연결 허용ㅇ다. 만약 연결 허용이 0으로 설정되면, 이 순간 코디네이터는 연결 요청을 받아들일 수 없다.
  
  비콘 프레임들은 GTS를 설정하는데 사용된다.
  GTS 사양 부필드는 PAN 코디네이터가 현재 GTS 요청을 받아들이 수 있는지 없는지 확실히 한다.
  또한 이 필드는 GTS 리스트 필드에서 GTS 목록의 번호를 결정한다.
  GTS 방향 부필드는 GTS의 방향을 수신 전용 또는 발신 전용 모드로 설정하기 위하여 사용되고는 한다.
  GTS 리스트는 현재 존재하는 모든 GTS 목록 이다.
  각 GTS 설명자는 GTS, GTS 시작 슬롯, GTS 길이를 사용하는 장비의 짧은 주소를 포함한다.
  
  주소 보류 필드는 코디네이터에서 데이터 보류르 ㄹ가진 모든 장비의 주소를 포함한다.
  각 장비는 이 필드에서 자신의 주소를 확인하고, 만약 주소가 있다면 장비는 코디네이터에 접근하고 데이터가 전송되도록 요청할 것이다.
  
  비콘 페이로드는 선택적인 필드이고 다음 계층인 NWK에 의하여 제공된다.


![image](https://user-images.githubusercontent.com/43804441/52567991-e7a32180-2e50-11e9-8aac-d47edfe6aad7.png)


### THE MAC Data Frame Format

  MAC 데이터 프레임은 그림 3.24a에서 보여진다.
  데이터 페이로드는 NWK층에 의해 MSDU로서 제공되어진다.
  MAC 데이터 프레임은 MPDU라고 불려진다. 순서번호 필드는 프레임이 생성 될 때의macDSN의 현재 값과 같다.
  
  
### THE MAC Acknowledgment Frame Format

  위 그림에서의 MAC 승인 프레임은 패킷의 성공적인 수신을 알리기 위해서 수신 장비에 의해 전송 장비로 선택적으로 보내진다.
  또한 이 프레임을 사용하여 수신자가 해당 장치에 보류 중인 데이터가 있음을 알수 있다.
  이 행동은 프레임 제어 필드의 프레임 보류 부필드를 1로 설정함으로 수행될 수 있다.
  순서 번호 피르는 macDSN의 현재 값과 동일하다.
  

### THE MAC Command Frame Format

  MAC 명령 프레임은 MAC 층의 제어를 수신 장비에게 보내질 때 사용되곤 한다.
  순서 번호 필드는 승인되는 프레임의 현재 macSDN 값과 동일하다.
  
  MAC 명령의 목록은 위 표 3.8을 통해 알수 있다.
  명령 프레임 식별자 필드는 표 3.8의 명령 중 어떤 명령이 실행 중인지 결정한다.
  명령 자체와 모든 관련된 매개변수들은 명령 페이로드에 배치된다.
  FFD는 모든 명령을 전송하고 수신할 수 있어야한다.
  그러나 RFD는 표에서 체크마크된 명령만 송/수신 할 수 있으면 된다.


![image](https://user-images.githubusercontent.com/43804441/52569239-0eaf2280-2e54-11e9-9832-1294c77c7bf0.png)

  
#### THE Assodicaiont request and pesponse commnad formats

   연결 명령은 MAC 서비스의 일부분으로 사용된다.
   연결 요청과 응답의 형식들은 그림 3.25에서 보이는 바와 같다.
   연결 요청의 기능 정보 필드는 네트워크 가입을 요청한 장비에 관한 다음 질문들에 답하는데 도움이 된다.
   
   * PAN 코디네이터로서 장비가 활동할 수 있는 가?
      만약 장비가 PAN 코디네이터로서 활동할 수 없다면, alternate PAN 코디네이터 필드는 0으로 설정된다.
      
   * FFD 또는 RFD 인가?
      장비 타입 필드는 1이라면 장비는 FFD이다.
   
   * 장치 배터리가 전원이거나 주 전원에 연결되어 있는가?
      배터리 전원 장비의 경우 전원 필드를 0으로 설정한다.
      
   * 장치가 항상 수신기를 ON 모드로 유지하거나 기기가 유휴 모드에 있을 때 수신기를 끄고 절전 모드로 전환하는가?
      만약 수신기가 유후 모드일 때 꺼진다면 수신기는 유후 필드가 0으로 설정되었을 때 ON 될 것이다.....??????
      이 필드의 내용은 MAC의 속성인 macRxOnWhenIdle에서 나오는데, 수신기가 유후 모드동안 꺼져있을 경우 실패로 설정된다.
    
   * 기기가 암호화 방식으로 보호된 MAC 프레임을 수신하거나 전송할 수 있는 가?
      만약 가능하다면, 보안 기능 필드는 1로 설정된다.
   
   * 장비가 네트워크에 가입한 후에 새로운 주소를 원하는 가?
      만약 장비가 짧은 주소를 필요로 한다면, 할당 주소 필드는 1로 설정된다.
      
   코디네이터는 장비로부터 연결 요청을 승인하거나 부인하기 위하여 연결 응답 명령을 사용한다.
   만약 코디네이터가 수용량에 도달하면, 연결 응답은 용량 상태에 PAN을 표시할 것이다.
   만약 연결 요청이 반아들여지고 장비가 새 주소를 요청하면 짧은 주소는 연결 응답의 짧은 주소 필드에서 제공된다.


![image](https://user-images.githubusercontent.com/43804441/52570350-87af7980-2e56-11e9-8a07-b0e2c7f04f24.png)


#### THE disassociation notification command format

   해제는 장비가 네트워크를 더날 의향이 있다는 것을 코디네이터에게 알리기 위한 연결된 장비의 절차이다.
   해제 프레임 형식은 그림 3.26에서 보여진다.
   장비는 자신의 결정이나 코디네이터의 요청에 기초하여 네트워크를 떠날 것이다.
   
   
![image](https://user-images.githubusercontent.com/43804441/52570464-ccd3ab80-2e56-11e9-839a-8a8b96fb33a6.png)


#### THE data request command format

   데이터 요청 명령에서 MAC 페이로드는 오직 명령 프레임 식별자를 포함한다. 그림 3.27
   이 명령은 간접 데이터 전송 방식으로서 코디네이터로부터 요청된 데이터로 사용된다.
   만약 장비가 비콘 프레임의 보류 주소 필드에서 자신의 주소를 찾는다면, 코디네이터에 그 장비에 대한 보류 데이터가 있다는 것을 알 수 있다.
   
   
    
